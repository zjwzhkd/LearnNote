# C++学习笔记2 - C++中的引用

[TOC]

## 布尔类型

* C++在C语言的基本类型系统上增加了bool
* C++中的bool可取的值只有true和false
* 理论上bool只占用一个字节
    * 如果多个bool变量定义在一起, 可能会各占一个bit, 这取决于编译器的实现
* true在编译器内部用1来表示, false在编译器内部用0表示
* bool类型只有true(非0)和false(0)两个值
    * C++编译器会在**赋值时**将非0值转换为true, 0值转换为false

## 三目运算符的升级
* C语言中的三目运算符返回的是变量值, 不能作为左值使用
* C++中的三目运算符可直接返回变量本身, 因此可以出现在程序的任何地方
* 若三目运算符可能返回的值中如果有一个是常数值, 则不能作为左值使用

## C++中的引用
* 变量名
    * 变量是一段实际连续存储空间的别名
    * 程序中通过变量来申请并命名存储空间
    * 通过变量的名字可以使用存储空间
* 引用的概念
    * 引用可以看作一个已定义变量的别名
    * 引用的语法: `Type& name = var;`
    * 普通引用在声明时**必须用其它的变量进行初始化**
    * 引用作为函数参数声明时**不进行初始化**
* 引用的意义
    * 引用作为其它变量的别名而存在, 因此在一些场合可以代替指针
    * 引用相对于指针来说具有更好的可读性和实用性
* const引用
    * 在C++中可以声明const引用
    * 语法: `const Type& name = var;`
    * const引用让变量拥有只读属性
    * 当使用常量对const引用进行初始化时, C++编译器会为常量值分配空间, 并且将引用名作为这段空间的别名
        * 使用常量对const引用初始化后将生成一个**只读变量**, 相当于C语言中的const变量
        * 不能使用常量值初始化普通引用
        * 相当于为常量分配一段**只读的临时空间**, 并使用const引用为这段临时空间生成一个别名
* 引用的实现
    * 引用在C++的内部实现是一个常指针
    * `Type& name`等价于`Type * const pname`, `name`等价于`*pname`
    * C++编译器在编译过程中使用常指针作为引用的内部实现, 因此引用所占的空间大小与指针相同
    * 从使用的角度, 引用会让人误会其只是一个别名, 没有自己的存储空间, 这是C++为了实用性而做出的细节隐藏
        * 从语法意义上来讲, 引用与指针是两个不同的概念
        * 从内部实现上来讲, C++编译器使用常指针实现引用
    * `void f(int& a)`在内部实现等价于`void f(int * const pa)`
* 引用作为返回值
    * 若返回栈变量
        * 不能成为其它引用的初始值
        * 不能作为左值使用
    * 若返回静态变量或全局变量
        * 可以成为其它引用的初始值
        * 既可以作为右值使用, 也可作为左值使用

## 三目运算符在C++中的实现
* 当三目运算符的可能返回值都是变量时, 返回的是变量的引用
* 当三目运算符的可能返回值中有常量时, 返回的是值

## 小结
* bool类型是C++新增加的基础类型, 其值只能是true和false
* C++中的引用可以看作变量的别名来使用
* C++中的常引用可以使得一个变量拥有只读属性
* C++中的常引用可以用常量初始化而得到一个只读变量
* C++中引用的本质是一个指针变量

## 思考
1. 在C++中不允许定义引用数组Type& a[N], 为什么?
    * 在语法的意义上, 引用是变量的别名, 并不是变量, 引用数组是没有意义的
2. 如何定义一个数组的引用? 如何定义一个函数引用?
    * 数组的引用:

        ```c++
        // 方法1
        int a[5] = {0};
        int (&b)[5] = a;

        // 方法2
        typedef int A[5];
        A a = {0};
        A& b = a;
        ```

    * 函数引用:

        ```c++
        // 方法1
        int f(int);
        int (&g)(int) = f;

        // 方法2
        typedef int F(int);
        int f(int);
        F& g = f;
        ```

3. 数组引用和数组指针有什么区别? 函数引用和函数指针有什么区别?
    * 在语法意义上, 引用是变量的别名, 指针则是保存变量地址的变量, 是两个不同的概念
    * 在C++内部实现中, 引用使用常指针实现
    * 数组引用或函数引用是数组或函数的别名, 相当于直接替换为原本的数组或函数名
    * 数组指针或函数指针是保存数组或函数地址的变量, 它拥有自己的存储空间
